{% load static cloudinary %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i&display=swap" rel="stylesheet">
  
  <title>{{ post.postname }} | Blog Post</title>

  <!-- Bootstrap core CSS -->
  <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">

  <!-- Additional CSS Files -->
  <link rel="stylesheet" href="{% static 'assets/css/fontawesome.css' %}">
  <link rel="stylesheet" href="{% static 'assets/css/templatemo-stand-blog.css' %}">
  <link rel="stylesheet" href="{% static 'assets/css/owl.css' %}">
  
  <style>
    .blog-thumb img {
      width: 100%;
      height: 400px;
      object-fit: cover;
      border-radius: 10px;
    }
    
    .post-content {
      line-height: 1.8;
      font-size: 1.1rem;
    }
    
    .comment-box {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
  </style>
</head>

<body>
  {% include 'header.html' %}

  <section class="blog-posts grid-system">
    <div class="container">
      <div class="row">
        <div class="col-lg-8">
          <div class="all-blog-posts">
            <div class="row">
              <div class="col-lg-12">
                <div class="blog-post">
                  <div class="blog-thumb">
                    {% if post.image %}
                      <img src="{{ post.image.url|cloudinary_url:{'width': 1200, 'height': 400, 'crop': 'fill'}" }}" alt="{{ post.postname }}">
                    {% else %}
                      <img src="{% static 'assets/images/default-post.jpg' %}" alt="Default post image">
                    {% endif %}
                  </div>
                  <div class="down-content">
                    <span class="badge bg-primary">{{ post.category }}</span>
                    <h2>{{ post.postname }}</h2>
                    <ul class="post-info">
                      <li><i class="fa fa-user"></i> {{ post.user }}</li>
                      <li><i class="fa fa-calendar"></i> {{ post.time|date:"F d, Y" }}</li>
                    </ul>
                    <div class="post-content mt-4">
                      {{ post.content|linebreaks }}
                    </div>
                  </div>
                </div>
              </div>

              <!-- Comments Section -->
              <div class="col-lg-12 mt-5">
                <div class="sidebar-item comments">
                  <div class="sidebar-heading">
                    <h3>{{ total_comments }} Comments</h3>
                  </div>
                  <div class="content">
                    <ul class="list-unstyled">
                      {% for comment in comments %}
                      <li class="comment-box">
                        <div class="d-flex justify-content-between">
                          <h5>{{ comment.user }}</h5>
                          <small class="text-muted">{{ comment.time|timesince }} ago</small>
                        </div>
                        <p class="mt-2">{{ comment.content }}</p>
                        {% if post.user == user or comment.user == user %}
                        <a href="{% url 'deletecomment' comment.id %}" class="text-danger small">Delete</a>
                        {% endif %}
                      </li>
                      {% endfor %}
                    </ul>
                  </div>
                </div>
              </div>

              <!-- Comment Form -->
              {% if user.is_authenticated %}
              <div class="col-lg-12 mt-4">
                <div class="sidebar-item submit-comment">
                  <div class="sidebar-heading">
                    <h3>Leave a Comment</h3>
                  </div>
                  <div class="content">
                    <form id="comment" action="{% url 'savecomment' post.id %}" method="post">
                      {% csrf_token %}
                      <div class="row">
                        <div class="col-lg-12">
                          <textarea name="message" rows="5" class="form-control" placeholder="Your comment..." required></textarea>
                        </div>
                        <div class="col-lg-12 mt-3">
                          <button type="submit" class="btn btn-primary">Post Comment</button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-4">
          <div class="sidebar">
            <div class="row">
              <div class="col-lg-12">
                <div class="sidebar-item recent-posts">
                  <div class="sidebar-heading">
                    <h3>Recent Posts</h3>
                  </div>
                  <div class="content">
                    <ul class="list-unstyled">
                      {% for recent_post in recent_posts|slice:"0:4" %}
                      <li class="d-flex mb-3">
                        {% if recent_post.image %}
                        <div class="flex-shrink-0">
                          <img src="{{ recent_post.image.url|cloudinary_url:{'width': 80, 'height': 80, 'crop': 'fill'}" }}" 
                               alt="{{ recent_post.postname }}" 
                               class="rounded" 
                               style="width: 80px; height: 80px; object-fit: cover;">
                        </div>
                        {% endif %}
                        <div class="ms-3">
                          <a href="{% url 'post' recent_post.id %}" class="text-decoration-none">
                            <h6>{{ recent_post.postname }}</h6>
                            <small class="text-muted">{{ recent_post.time|date:"M d, Y" }}</small>
                          </a>
                        </div>
                      </li>
                      {% endfor %}
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  {% include 'footer.html' %}

  <!-- Scripts -->
  <script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
  <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'assets/js/custom.js' %}"></script>
</body>
</html>